<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DriveSense | Find Your Perfect Car</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .hero-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .filter-sidebar { max-height: calc(100vh - 120px); }
        .carousel-slide { min-width: 100%; }
        .price-tag { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .featured-badge { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .sold-badge { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .new-badge { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.6s ease-out; }
        .compare-checkbox:checked + div { border-color: #667eea; background-color: #ebf4ff; }
        .heart-checkbox:checked + div .heart-icon { color: #ef4444; }
        .car-image { width: 100%; height: 200px; object-fit: cover; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .currency-toggle { cursor: pointer; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Top Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <!-- Logo -->
                <div class="flex items-center">
                    <i class="fas fa-car text-3xl text-blue-600 mr-3"></i>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Drive<span class="text-blue-600">Sense</span></h1>
                        <p class="text-xs text-gray-500">Find Your Dream Car</p>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#" class="text-gray-700 hover:text-blue-600 font-medium">Home</a>
                    <a href="#featured" class="text-gray-700 hover:text-blue-600 font-medium">Featured</a>
                    <a href="#new-arrivals" class="text-gray-700 hover:text-blue-600 font-medium">New Arrivals</a>
                    <a href="#deals" class="text-gray-700 hover:text-blue-600 font-medium">Great Deals</a>
                    <a href="#how-it-works" class="text-gray-700 hover:text-blue-600 font-medium">How It Works</a>
                </div>

                <!-- User Actions -->
                <div class="flex items-center space-x-6">
                    <div id="currencyToggle" class="currency-toggle bg-gray-100 px-3 py-1 rounded-lg font-medium">
                        <span id="currentCurrency">KSH</span>
                        <i class="fas fa-exchange-alt ml-2"></i>
                    </div>
                    <button onclick="showCompareModal()" class="relative">
                        <i class="fas fa-exchange-alt text-gray-600 text-xl hover:text-blue-600"></i>
                        <span id="compareCount" class="absolute -top-2 -right-2 bg-blue-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                    <button onclick="showWishlist()" class="relative">
                        <i class="fas fa-heart text-gray-600 text-xl hover:text-red-600"></i>
                        <span id="wishlistCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                    <a href="admin.html" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">
                        <i class="fas fa-cog mr-2"></i> Admin
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- ... Rest of your existing HTML remains the same until the end ... -->

    <script>
        // Currency conversion rate (approximate)
        const USD_TO_KSH = 130;
        
        // Current currency state
        let currentCurrency = 'KSH';
        
        // Global cars data - will be loaded from JSON
        let carsData = [];
        
        // User state
        let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
        let compareList = JSON.parse(localStorage.getItem('compareList')) || [];
        let currentPage = 1;
        let currentView = 'grid';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadCarsData();
            
            // Initialize carousel scroll
            initializeCarousel();
            
            // Add currency toggle event
            document.getElementById('currencyToggle').addEventListener('click', toggleCurrency);
        });

        // Load cars data from JSON file
        async function loadCarsData() {
            try {
                const response = await fetch('data/cars.json');
                if (!response.ok) throw new Error('Failed to load car data');
                carsData = await response.json();
                loadFeaturedCars();
                loadCarsGrid();
                updateCounts();
            } catch (error) {
                console.error('Error loading cars data:', error);
                // Load default data if JSON doesn't exist
                loadDefaultCarsData();
            }
        }

        // Load default data if JSON file is not available
        function loadDefaultCarsData() {
            carsData = [
                {
                    id: 1,
                    make: "Toyota",
                    model: "Land Cruiser V8",
                    year: 2022,
                    price: 18500000,
                    mileage: 12000,
                    transmission: "Automatic",
                    fuel: "Diesel",
                    color: "White",
                    bodyType: "SUV",
                    description: "Fully loaded Land Cruiser V8 in perfect condition.",
                    location: "Nairobi, Kenya",
                    dealer: "Toyota Kenya",
                    rating: 4.8,
                    featured: true,
                    status: "available",
                    images: ["https://images.unsplash.com/photo-1563720223486-3292c31c5c3b?w=800&h=400&fit=crop&crop=center"],
                    dateAdded: "2024-01-15"
                }
                // ... other default cars
            ];
            loadFeaturedCars();
            loadCarsGrid();
            updateCounts();
        }

        // Format price based on current currency
        function formatPrice(priceInKSH, showBoth = false) {
            if (currentCurrency === 'KSH') {
                const formatted = 'KSH ' + priceInKSH.toLocaleString();
                if (showBoth) {
                    const usdPrice = Math.round(priceInKSH / USD_TO_KSH);
                    return formatted + ` (≈$${usdPrice.toLocaleString()} USD)`;
                }
                return formatted;
            } else {
                const usdPrice = Math.round(priceInKSH / USD_TO_KSH);
                return '$' + usdPrice.toLocaleString() + ' USD';
            }
        }

        // Toggle currency
        function toggleCurrency() {
            currentCurrency = currentCurrency === 'KSH' ? 'USD' : 'KSH';
            document.getElementById('currentCurrency').textContent = currentCurrency;
            
            // Reload all car displays
            loadFeaturedCars();
            loadCarsGrid();
            
            // Update car detail modal if open
            const modal = document.getElementById('carDetailModal');
            if (!modal.classList.contains('hidden')) {
                const carId = modal.dataset.currentCarId;
                if (carId) {
                    viewCarDetails(parseInt(carId));
                }
            }
            
            showToast(`Currency changed to ${currentCurrency}`);
        }

        // Load featured cars for carousel
        function loadFeaturedCars() {
            const featuredCars = carsData.filter(car => car.featured && car.status !== 'sold');
            const carousel = document.getElementById('featuredCarousel');
            if (!carousel) return;
            
            carousel.innerHTML = '';
            
            featuredCars.forEach(car => {
                const carSlide = document.createElement('div');
                carSlide.className = 'carousel-slide min-w-[400px] fade-in';
                carSlide.innerHTML = `
                    <div class="bg-white rounded-xl shadow overflow-hidden card-hover">
                        <div class="relative">
                            <img src="${car.images && car.images.length > 0 ? car.images[0] : 'https://images.unsplash.com/photo-1494976388531-d1058494cdd8?w=800&h=400&fit=crop'}" 
                                 alt="${car.make} ${car.model}" class="w-full h-48 object-cover">
                            <span class="absolute top-4 left-4 featured-badge text-white px-3 py-1 rounded-full text-sm font-bold">
                                <i class="fas fa-star mr-1"></i> FEATURED
                            </span>
                            <button onclick="toggleWishlist(${car.id})" class="absolute top-4 right-4 bg-white p-2 rounded-full shadow hover:bg-gray-100">
                                <i class="fas fa-heart ${wishlist.includes(car.id) ? 'text-red-500' : 'text-gray-400'}"></i>
                            </button>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-gray-900">${car.year} ${car.make} ${car.model}</h3>
                            <div class="flex items-center mt-2">
                                <span class="text-2xl font-bold text-blue-600">${formatPrice(car.price)}</span>
                                <span class="ml-4 text-sm text-gray-600"><i class="fas fa-tachometer-alt mr-1"></i>${car.mileage.toLocaleString()} km</span>
                            </div>
                            <div class="flex items-center mt-4">
                                <div class="flex text-yellow-400">
                                    ${'<i class="fas fa-star"></i>'.repeat(Math.floor(car.rating))}
                                </div>
                                <span class="ml-2 text-gray-600">${car.rating}</span>
                                <span class="mx-2">•</span>
                                <span class="text-gray-600">${car.dealer}</span>
                            </div>
                            <button onclick="viewCarDetails(${car.id})" class="w-full mt-4 bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition">
                                View Details
                            </button>
                        </div>
                    </div>
                `;
                carousel.appendChild(carSlide);
            });
        }

        // Load cars in grid view
        function loadCarsGrid() {
            const grid = document.getElementById('carsGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            const start = (currentPage - 1) * 6;
            const end = start + 6;
            const availableCars = carsData.filter(car => car.status !== 'sold');
            const carsToShow = availableCars.slice(start, end);
            
            if (document.getElementById('resultsCount')) {
                document.getElementById('resultsCount').textContent = availableCars.length;
            }
            
            carsToShow.forEach(car => {
                const carCard = document.createElement('div');
                carCard.className = 'bg-white rounded-xl shadow overflow-hidden card-hover fade-in';
                carCard.innerHTML = `
                    <div class="relative">
                        <img src="${car.images && car.images.length > 0 ? car.images[0] : 'https://images.unsplash.com/photo-1494976388531-d1058494cdd8?w=800&h=400&fit=crop'}" 
                             alt="${car.make} ${car.model}" class="w-full h-48 object-cover">
                        ${car.featured ? `
                        <span class="absolute top-4 left-4 featured-badge text-white px-3 py-1 rounded-full text-sm font-bold">
                            <i class="fas fa-star mr-1"></i> FEATURED
                        </span>` : ''}
                        ${car.status === 'sold' ? `
                        <span class="absolute top-4 left-4 sold-badge text-white px-3 py-1 rounded-full text-sm font-bold">
                            <i class="fas fa-check mr-1"></i> SOLD
                        </span>` : ''}
                        <button onclick="toggleWishlist(${car.id})" class="absolute top-4 right-4 bg-white p-2 rounded-full shadow hover:bg-gray-100">
                            <i class="fas fa-heart ${wishlist.includes(car.id) ? 'text-red-500' : 'text-gray-400'}"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-gray-900">${car.year} ${car.make} ${car.model}</h3>
                        <div class="flex items-center mt-2">
                            <span class="text-2xl font-bold text-blue-600">${formatPrice(car.price)}</span>
                            <span class="ml-4 text-sm text-gray-600"><i class="fas fa-tachometer-alt mr-1"></i>${car.mileage.toLocaleString()} km</span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2 mt-4 text-sm text-gray-600">
                            <div><i class="fas fa-cog mr-2"></i> ${car.transmission}</div>
                            <div><i class="fas fa-gas-pump mr-2"></i> ${car.fuel}</div>
                            <div><i class="fas fa-paint-brush mr-2"></i> ${car.color}</div>
                            <div><i class="fas fa-car mr-2"></i> ${car.bodyType}</div>
                        </div>
                        
                        <div class="flex items-center mt-4">
                            <div class="flex text-yellow-400">
                                ${'<i class="fas fa-star"></i>'.repeat(Math.floor(car.rating))}
                            </div>
                            <span class="ml-2 text-gray-600">${car.rating}</span>
                            <span class="mx-2">•</span>
                            <span class="text-gray-600">${car.dealer}</span>
                        </div>
                        
                        <div class="flex space-x-2 mt-6">
                            <button onclick="viewCarDetails(${car.id})" class="flex-1 bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition">
                                <i class="fas fa-eye mr-1"></i> Details
                            </button>
                            <label class="cursor-pointer">
                                <input type="checkbox" class="hidden compare-checkbox" onchange="toggleCompare(${car.id})" ${compareList.includes(car.id) ? 'checked' : ''}>
                                <div class="bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition flex items-center justify-center">
                                    <i class="fas fa-exchange-alt mr-1"></i> Compare
                                </div>
                            </label>
                        </div>
                    </div>
                `;
                grid.appendChild(carCard);
            });
        }

        // View car details
        function viewCarDetails(carId) {
            const car = carsData.find(c => c.id === carId);
            if (!car) return;
            
            // Store current car ID in modal for currency updates
            document.getElementById('carDetailModal').dataset.currentCarId = carId;
            
            document.getElementById('modalCarTitle').textContent = `${car.year} ${car.make} ${car.model}`;
            
            // Display price in both currencies
            const priceElement = document.getElementById('modalCarPrice');
            const priceUSDElement = document.getElementById('modalCarPriceUSD');
            
            if (currentCurrency === 'KSH') {
                priceElement.textContent = formatPrice(car.price);
                priceUSDElement.textContent = `(≈$${Math.round(car.price / USD_TO_KSH).toLocaleString()} USD)`;
            } else {
                priceElement.textContent = formatPrice(car.price);
                priceUSDElement.textContent = '';
            }
            
            document.getElementById('modalCarDescription').textContent = car.description;
            
            // Set main image
            const mainImage = document.getElementById('modalMainImage');
            if (car.images && car.images.length > 0) {
                mainImage.src = car.images[0];
                mainImage.alt = `${car.make} ${car.model}`;
            }
            
            const specsContainer = document.getElementById('modalCarSpecs');
            specsContainer.innerHTML = `
                <div class="flex justify-between py-2 border-b">
                    <span class="text-gray-600">Mileage</span>
                    <span class="font-semibold">${car.mileage.toLocaleString()} km</span>
                </div>
                <div class="flex justify-between py-2 border-b">
                    <span class="text-gray-600">Transmission</span>
                    <span class="font-semibold">${car.transmission}</span>
                </div>
                <div class="flex justify-between py-2 border-b">
                    <span class="text-gray-600">Fuel Type</span>
                    <span class="font-semibold">${car.fuel}</span>
                </div>
                <div class="flex justify-between py-2 border-b">
                    <span class="text-gray-600">Color</span>
                    <span class="font-semibold">${car.color}</span>
                </div>
                <div class="flex justify-between py-2 border-b">
                    <span class="text-gray-600">Body Type</span>
                    <span class="font-semibold">${car.bodyType}</span>
                </div>
                <div class="flex justify-between py-2 border-b">
                    <span class="text-gray-600">Dealer</span>
                    <span class="font-semibold">${car.dealer}</span>
                </div>
                <div class="flex justify-between py-2 border-b">
                    <span class="text-gray-600">Location</span>
                    <span class="font-semibold">${car.location}</span>
                </div>
                <div class="flex justify-between py-2">
                    <span class="text-gray-600">Dealer Rating</span>
                    <span class="font-semibold">${car.rating}/5.0</span>
                </div>
            `;
            
            // Update additional images if available
            const additionalImages = document.querySelectorAll('#carDetailModal .grid-cols-2 img');
            if (car.images && car.images.length > 1) {
                additionalImages.forEach((img, index) => {
                    if (car.images[index + 1]) {
                        img.src = car.images[index + 1];
                    }
                });
            }
            
            document.getElementById('carDetailModal').classList.remove('hidden');
        }

        // ... Rest of your existing functions remain the same ...

        // Toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            if (!toast) return;
            
            toast.textContent = message;
            toast.classList.remove('translate-x-full');
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 3000);
        }

        // Carousel functions
        function initializeCarousel() {
            const carousel = document.getElementById('featuredCarousel');
            if (!carousel) return;
            carousel.scrollLeft = 0;
        }

        function scrollCarousel(direction) {
            const carousel = document.getElementById('featuredCarousel');
            if (!carousel) return;
            
            const scrollAmount = 400;
            carousel.scrollBy({
                left: direction === 'left' ? -scrollAmount : scrollAmount,
                behavior: 'smooth'
            });
        }

        // Load more cars
        function loadMoreCars() {
            currentPage++;
            loadCarsGrid();
            showToast(`Loaded page ${currentPage}`);
        }
    </script>
</body>
</html>